---
---
<style>
  .lightbox-overlay {
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .lightbox-overlay.open {
    opacity: 1;
    visibility: visible;
  }
  .lightbox-content {
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 0.3s ease 0.1s, transform 0.3s ease 0.1s;
  }
  .lightbox-overlay.open .lightbox-content {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<!-- Clickable backdrop -->
<div
  id="lightbox"
  class="lightbox-overlay fixed inset-0 z-50 bg-background/95 backdrop-blur-sm cursor-zoom-out"
  role="dialog"
  aria-modal="true"
  aria-label="Image lightbox"
>
  <!-- Content wrapper - stops click propagation -->
  <div class="h-full overflow-y-auto flex flex-col items-center justify-start pt-8 pb-12 px-4 md:px-8">
    <!-- Image -->
    <div class="lightbox-content shrink-0 cursor-default" id="lightbox-image-wrapper">
      <img
        id="lightbox-image"
        src=""
        alt="Lightbox view"
        class="max-h-[70vh] max-w-full object-contain rounded-lg shadow-2xl border border-border"
      >
    </div>

    <!-- Metadata section -->
    <div id="lightbox-metadata" class="lightbox-content w-full max-w-2xl mt-6 cursor-default">
      <!-- Camera & Lens -->
      <div class="flex flex-wrap gap-x-6 gap-y-2 font-mono text-sm mb-3">
        <span id="lightbox-camera" class="inline-flex items-center gap-2 text-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-tertiary"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>
          <span></span>
        </span>
        <span id="lightbox-lens" class="inline-flex items-center gap-2 text-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-tertiary"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
          <span></span>
        </span>
      </div>

      <!-- Shooting settings -->
      <div class="flex flex-wrap gap-x-4 gap-y-2 font-mono text-sm text-tertiary">
        <span id="lightbox-focal" class="inline-flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-accent"><circle cx="12" cy="12" r="10"/></svg>
          <span></span>
        </span>
        <span id="lightbox-aperture" class="inline-flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-tertiary"><circle cx="12" cy="12" r="10"/><path d="M14.31 8l5.74 9.94M9.69 8h11.48M7.38 12l5.74-9.94M9.69 16L3.95 6.06M14.31 16H2.83M16.62 12l-5.74 9.94"/></svg>
          <span></span>
        </span>
        <span id="lightbox-shutter" class="inline-flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-accent"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          <span></span>
        </span>
        <span id="lightbox-iso-val" class="inline-flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-accent"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 7h.01M17 7h.01M7 17h.01M17 17h.01"/></svg>
          <span></span>
        </span>
      </div>

      <!-- Date -->
      <div id="lightbox-date" class="font-mono text-xs text-tertiary mt-3 opacity-75"></div>
    </div>
  </div>
</div>

<script is:inline>
  function initLightbox() {
    const lightbox = document.getElementById("lightbox");
    const lightboxImage = document.getElementById("lightbox-image");
    const lightboxImageWrapper = document.getElementById("lightbox-image-wrapper");
    const lightboxMetadata = document.getElementById("lightbox-metadata");
    const photoImages = Array.from(document.querySelectorAll("[data-lightbox]"));

    const metaCamera = document.querySelector("#lightbox-camera span");
    const metaLens = document.querySelector("#lightbox-lens span");
    const metaFocal = document.querySelector("#lightbox-focal span");
    const metaAperture = document.querySelector("#lightbox-aperture span");
    const metaShutter = document.querySelector("#lightbox-shutter span");
    const metaISO = document.querySelector("#lightbox-iso-val span");
    const metaDate = document.getElementById("lightbox-date");

    function updateMetadata(imgElement) {
      try {
        const data = JSON.parse(imgElement.dataset.metadata || "{}");
        if (metaCamera) metaCamera.textContent = `${data.make || ''} ${data.camera || ''}`.trim();
        if (metaLens) metaLens.textContent = `${data.lensMake || ''} ${data.lensModel || ''}`.trim();
        if (metaFocal) metaFocal.textContent = data.focalLength ? `${data.focalLength}mm` : '';
        if (metaAperture) metaAperture.textContent = data.FStop ? `Æ’${data.FStop}` : '';
        if (metaShutter) metaShutter.textContent = data.exposure || '';
        if (metaISO) metaISO.textContent = data.iso ? `ISO ${data.iso}` : '';
        if (metaDate && data.taken) {
          metaDate.textContent = new Date(data.taken).toLocaleDateString(undefined, {
            year: "numeric", month: "long", day: "numeric",
          });
        } else if (metaDate) {
          metaDate.textContent = '';
        }
      } catch (e) {
        console.error("Error parsing metadata", e);
      }
    }

    function openLightbox(imgElement) {
      if (lightboxImage) {
        lightboxImage.src = imgElement.dataset.largeUrl || imgElement.src;
        updateMetadata(imgElement);
      }
      lightbox?.classList.add("open");
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      lightbox?.classList.remove("open");
      document.body.style.overflow = '';
    }

    photoImages.forEach((img) => {
      img.style.cursor = "zoom-in";
      img.addEventListener("click", () => openLightbox(img));
    });

    // Click on backdrop (not on image or metadata) closes lightbox
    lightbox?.addEventListener("click", (e) => {
      // Check if click is on the backdrop itself, not on content
      const isOnImage = lightboxImageWrapper?.contains(e.target);
      const isOnMetadata = lightboxMetadata?.contains(e.target);
      if (!isOnImage && !isOnMetadata) {
        closeLightbox();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (!lightbox?.classList.contains("open")) return;
      if (e.key === "Escape") closeLightbox();
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initLightbox);
  } else {
    initLightbox();
  }
  document.addEventListener("astro:page-load", initLightbox);
</script>
