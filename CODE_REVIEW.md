# Code Review Report

**Date:** November 23, 2025
**Project:** Portfolio (Astro + Tailwind + Cloudflare)

## Executive Summary

The project is a modern, well-structured static site portfolio built with Astro. It effectively leverages Astro's content layer (including experimental "live" collections) and latest CSS technologies (Tailwind v4). The codebase is generally clean and follows good practices, but there are opportunities for improvement in code reuse, dependency management, and potential performance optimizations for large datasets.

## 1. Configuration & Dependencies

### 1.1. Mixed Package Managers
**Observation:** The root directory contains both `bun.lock` and `pnpm-lock.yaml`.
**Risk:** This can lead to inconsistent dependency versions between environments and developers.
**Recommendation:** Choose one package manager (likely `pnpm` given `package.json` structure, or `bun` if preferred) and delete the other lock file. Add the chosen lock file to git and CI workflows.

### 1.2. Experimental Tailwind Version
**Observation:** The project uses `@tailwindcss/vite` version `4.1.17` and `tailwindcss` `4.1.17`.
**Risk:** While cutting-edge, experimental/beta versions can introduce breaking changes or instability.
**Recommendation:** Ensure this version is pinned deliberately. Keep an eye on stable releases for Tailwind v4.

## 2. Architecture & Components

### 2.1. Layout Duplication (DRY Violation)
**Observation:** `src/pages/writing/[slug].astro` does not use `src/layouts/BaseLayout.astro`. Instead, it duplicates the entire HTML shell (`<html>`, `<head>`, `<body>`, meta tags, scripts).
**Risk:** Maintenance burden. Updates to global scripts (like analytics), meta tags, or styles must be applied in two places. Inconsistencies can easily creep in.
**Recommendation:** Refactor `src/pages/writing/[slug].astro` to use `BaseLayout`. You can pass the specific `title` and `description` as props. If the blog post layout needs significant custom styling, consider creating a `BlogPostLayout` that wraps `BaseLayout` or shares a common `Head` component.

### 2.2. Lightbox Implementation
**Observation:** `src/components/Lightbox.astro` uses:
-   Absolute positioning with magic numbers (`bottom-[158px]`).
-   Inline JavaScript that attaches listeners to DOM elements found via query selector.
-   `JSON.stringify` to store full photo metadata in a `data-metadata` attribute on every thumbnail.
**Risk:**
-   **Fragility:** The close button position might break on different screen sizes or text flows.
-   **Payload Size:** Storing the full JSON object for every photo in the DOM increases HTML size, especially for a large gallery.
**Recommendation:**
-   Use flexbox/grid or relative positioning for the close button to ensure it stays within the viewport/container logically.
-   Consider fetching metadata on demand or storing it in a global JS object (window.photos) referenced by ID, rather than embedding it in the DOM.

## 3. Data Layer & Performance

### 3.1. Photos Loader Scalability
**Observation:** `src/lib/loaders/photos.ts` fetches *all* photos from the API at build/request time (`while (hasMore)`).
**Risk:** As the photo collection grows, this will slow down builds (SSG) or request times (SSR/Live).
**Recommendation:**
-   If the number of photos is expected to be small (< 1000), this is fine.
-   If scaling up, consider implementing pagination at the UI level (loading more photos client-side) or incremental builds if Astro supports it for your adapter.

### 3.2. Environment Variables
**Observation:** Loaders rely on `import.meta.env`.
**Recommendation:** Ensure `astro env` or a validation step checks for the existence of these variables at build start to fail fast if credentials are missing.

## 4. Styling & UI

### 4.1. Font Loading
**Observation:** Fonts are imported in `BaseLayout` and `[slug].astro`.
**Status:** Good use of `@fontsource`.

### 4.2. Hardcoded Layouts
**Observation:** `src/pages/photos.astro` uses a manual column split for a masonry layout (`col1`, `col2`).
**Risk:** This layout is rigid (2 columns). On wider screens, you might want 3, or on tablets, 2.
**Recommendation:** Consider a CSS-only masonry solution (if supported by target browsers) or a more robust JavaScript masonry library/script if precise control is needed. For now, the current solution is acceptable but limited.

## 5. Security

### 5.1. Content Security Policy (CSP)
**Observation:** `csp: true` is enabled in `astro.config.mjs`.
**Status:** Excellent proactive security measure.

## Action Plan

1.  **Immediate Fix:** Delete the unused lock file (e.g., `rm bun.lock`).
2.  **Refactor:** Update `src/pages/writing/[slug].astro` to use `BaseLayout`.
3.  **Cleanup:** Review `Lightbox.astro` CSS positioning.

---
*Generated by Gemini CLI*
